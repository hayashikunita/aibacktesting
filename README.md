
# 日本株バックテストプロジェクト

このアプリは、日本株のシンプルな移動平均クロス戦略（SMA）を使い、バックテスト・パフォーマンス評価・AIによる戦略最適化を行うPythonアプリケーションです。

## 主な特徴

- シンボル（証券コード）を対話的に選択し、Yahoo!ファイナンスから自動でCSVデータを取得
- 取得済みCSVがあれば再ダウンロード不要
- 移動平均クロス戦略（SimpleStrategy）で売買シグナルを生成
- バックテスト結果から詳細なパフォーマンス指標を算出
- OpenAI API（ChatGPT）による戦略パラメータ最適化案の自動提案
- 日本語で分かりやすい出力

## ディレクトリ構成（主要ファイルのみ）

```
aibacktesting
├── src
│   ├── main.py                # アプリのエントリーポイント。シンボル選択・データ取得・バックテスト・AI最適化
│   ├── strategies/__init__.py # 移動平均クロス戦略（SimpleStrategy）
│   ├── data/__init__.py       # 日本株CSVデータの読み込み・前処理
│   ├── backtest/__init__.py   # バックテスト実行クラス
│   ├── utils/__init__.py      # パフォーマンス指標計算・日本語出力
│   ├── scripts/yahoofinance2csv.py # Yahoo!ファイナンスから株価取得
│   └── tools/ai_optimize_strategy.py # OpenAI APIによる戦略最適化
├── pyproject.toml             # Pythonプロジェクト設定ファイル
├── README.md                  # このドキュメント
```

## 必要なパッケージ

```
pip install -r requirements.txt
```
または
```
pip install -e .
```
（pyproject.toml利用の場合）

## 使い方

1. コマンドでアプリを起動します。

```
python src/main.py
```

2. 証券コード（例: 2267）を入力すると、Yahoo!ファイナンスから自動でCSVデータを取得します。
    - 既存CSVがあれば再取得せずそのまま利用します。
    - データは `src/data/japan_stock_シンボル.csv` に保存されます。

3. バックテストが実行され、以下の情報が日本語で表示されます。
    - 最終資金
    - トレード履歴（買い・売り・利益）
    - 詳細なパフォーマンス指標（累積リターン、年率リターン、ボラティリティ、シャープレシオ、勝率、期待値、最大ドローダウン、プロフィットファクター、ペイオフレシオ、リスクリワードレシオ、連勝・連敗数など）
    - OpenAI API（ChatGPT）による戦略パラメータ最適化案（APIキー要設定）

## パフォーマンス指標の例

```
パフォーマンス指標:
   累積リターン: 183.02%
   年率リターン: 12.34%
   ボラティリティ: 8.33%
   シャープレシオ: 1.23
   勝率: 53.85%
   期待値（1トレード・%）: 0.16%
   期待値（1トレード・金額）: 103.99 円
   平均利益（%）: 0.45%
   平均損失（%）: -0.17%
   平均利益（円）: 531.33 円
   平均損失（円）: -394.56 円
   トレード回数: 13 回
   最大ドローダウン: -43.26%
   プロフィットファクター: 3.11
   ペイオフレシオ: 2.66
   リスクリワードレシオ: 0.97
   最大連勝数: 2 回
   最大連敗数: 2 回
```

## OpenAI API（ChatGPT）による戦略最適化

- `src/tools/ai_optimize_strategy.py` でバックテスト結果をもとに、より良い戦略案とPythonコードを自動生成します。
- 利用にはOpenAI APIキーが必要です。
   - 環境変数 `OPENAI_API_KEY` または main.py の `api_key` で設定してください。

## データソース

- Yahoo!ファイナンス（自動取得）
- サンプル: https://kabu.plus/

## ライセンス

MITライセンス

## 免責事項

本アプリケーションは、投資判断や利益を保証するものではありません。提供する情報・分析結果・戦略案は参考目的であり、実際の投資はご自身の責任で行ってください。株式投資には元本割れ等のリスクが伴います。開発者は本アプリの利用による損失・トラブル等について一切の責任を負いません。

## 補足・他ツールの活用

本アプリの分析結果はあくまで参考情報です。MT5（MetaTrader 5）、Backtrader、TradingViewなど他のプラットフォームやツールでも検証・比較を行い、十分な裏付けを取ることを推奨します。複数の手法・ツールを活用し、より確かな投資判断を心がけてください。